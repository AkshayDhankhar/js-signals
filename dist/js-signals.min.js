/*
 * JS Signals <https://github.com/millermedeiros/js-signals>
 * Released under the MIT license (http://www.opensource.org/licenses/mit-license.php)
 * @author Miller Medeiros <http://millermedeiros.com>
 * @version 0.4
 * @build 73 12/01/2010 11:53 PM
 */
(function(){var a=window.signals={};a.Signal=function(){this._bindings=[]};a.Signal.prototype={_shouldPropagate:true,_isEnabled:true,_registerListener:function(f,e,d){var c=this._indexOfListener(f),g;if(c!==-1){g=this._bindings[c];if(g.isOnce()!==e){throw new Error("You cannot "+(e?"add()":"addOnce()")+" then "+(!e?"add()":"addOnce()")+" the same listener without removing the relationship first.")}}else{g=new a.SignalBinding(f,e,d,this);this._addBinding(g)}return g},_addBinding:function(c){this._bindings.push(c)},_indexOfListener:function(c){var d=this._bindings.length;while(d--){if(this._bindings[d]._listener===c){return d}}return -1},add:function(d,c){return this._registerListener(d,false,c)},addOnce:function(d,c){return this._registerListener(d,true,c)},remove:function(d){var c=this._indexOfListener(d);if(c!==-1){this._bindings.splice(c,1)}return d},removeAll:function(){this._bindings.length=0},getNumListeners:function(){return this._bindings.length},disable:function(){this._isEnabled=false},enable:function(){this._isEnabled=true},isEnabled:function(){return this._isEnabled},halt:function(){this._shouldPropagate=false},dispatch:function(f){if(!this._isEnabled){return}var c=Array.prototype.slice.call(arguments),g=this._bindings.slice(),d=0,e;this._shouldPropagate=true;while(e=g[d++]){if(e.execute(c)===false||!this._shouldPropagate){break}}},toString:function(){return"[Signal isEnabled: "+this._isEnabled+" numListeners: "+this.getNumListeners()+"]"}};a.SignalBinding=function b(f,d,c,e){this._listener=f;this._isOnce=d;this.context=c;this._signal=e};a.SignalBinding.prototype={_isEnabled:true,execute:function(c){if(this._isEnabled){if(this._isOnce){this.detach()}return this._listener.apply(this.context,c)}},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach();this._destroy()},_destroy:function(){delete this._signal;delete this._isOnce;delete this._listener;delete this.context},disable:function(){this._isEnabled=false},enable:function(){this._isEnabled=true},isEnabled:function(){return this._isEnabled},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding listener: "+this.listener+", isOnce: "+this._isOnce+", isEnabled: "+this._isEnabled+", listenerScope: "+this.listenerScope+"]"}}}());