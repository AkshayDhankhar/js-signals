/*

 JS Signals <http://millermedeiros.github.com/js-signals/>
 Released under the MIT license
 Author: Miller Medeiros
 Version: 0.6.3+ - Build: 234 (2011/10/28 12:21 PM)
*/
(function(i){function h(a,b,c,e,g){this._listener=b;this._isOnce=c;this.context=e;this._signal=a;this._priority=g||0}function f(a,b){if(typeof a!=="function")throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}var d={VERSION:"0.6.3+"};h.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());return b},detach:function(){return this.isBound()?
this._signal.remove(this._listener):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};d.Signal=function(){this._bindings=[];this._prevParams=null};d.Signal.prototype={memorize:!1,_shouldPropagate:!0,
active:!0,_registerListener:function(a,b,c,e){var g=this._indexOfListener(a);if(g!==-1){if(a=this._bindings[g],a.isOnce()!==b)throw Error("You cannot add"+(b?"":"Once")+"() then add"+(!b?"":"Once")+"() the same listener without removing the relationship first.");}else a=new h(this,a,b,c,e),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);
this._bindings.splice(b+1,0,a)},_indexOfListener:function(a){for(var b=this._bindings.length;b--;)if(this._bindings[b]._listener===a)return b;return-1},has:function(a){return this._indexOfListener(a)!==-1},add:function(a,b,c){f(a,"add");return this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){f(a,"addOnce");return this._registerListener(a,!0,b,c)},remove:function(a){f(a,"remove");var b=this._indexOfListener(a);b!==-1&&(this._bindings[b]._destroy(),this._bindings.splice(b,1));return a},removeAll:function(){for(var a=
this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.slice(),e=c.length;if(this.memorize)this._prevParams=b;this._shouldPropagate=!0;do e--;while(c[e]&&this._shouldPropagate&&c[e].execute(b)!==!1)}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();
delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};(function(){function a(a){d.Signal.call(this);for(var b=Array.prototype.slice.call(arguments,0),c=b.length,f;c--;)f=b[c].add(this._registerDispatch,this),f.params=[c];this._signals=b;this._params=[];this._resolved=!1}var b=d.Signal.prototype,c=new d.Signal;a.prototype=c;a.prototype.constructor=a;c.override=!1;c.unique=!0;c.memorize=!0;c._registerDispatch=
function(a,b){if(!this._params[a]||this.override)this._params[a]=Array.prototype.slice.call(arguments,1);this._registeredAll()&&(!this._resolved||!this.unique)&&this.dispatch.apply(this,this._params)};c._registeredAll=function(){if(this._params.length!==this._signals.length)return!1;else{for(var a=0,b=this._params.length;a<b;a+=1)if(!this._params[a])return!1;return!0}};c.dispatch=function(a){a=this._resolved&&this.unique?this._params:Array.prototype.slice.call(arguments,0);this._resolved=!0;b.dispatch.apply(this,
a);this.unique?this.removeAll():this.reset()};c.reset=function(){this._params.length=0;this._resolved=!1};c.isResolved=function(){return this._resolved};c.dispose=function(){b.dispose.call(this);delete this._signals;delete this._params};c.toString=function(){return"[CompoundSignal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"};d.CompoundSignal=a})();typeof define==="function"&&define.amd?define("signals",[],d):typeof module!=="undefined"&&module.exports?module.exports=d:i.signals=
d})(this);
