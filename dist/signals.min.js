/*!
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
 * @author Miller Medeiros <http://millermedeiros.com/>
 * @version 0.6.3+
 * @build 227 (2011/10/28 11:59 AM)
 */
(function(d){var b={VERSION:"0.6.3+"};function c(i,h,f,g,e){this._listener=h;this._isOnce=f;this.context=g;this._signal=i;this._priority=e||0}c.prototype={active:true,params:null,execute:function(e){var g,f;if(this.active&&!!this._listener){f=this.params?this.params.concat(e):e;g=this._listener.apply(this.context,f);if(this._isOnce){this.detach()}}return g},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return(!!this._signal&&!!this._listener)},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function a(e,f){if(typeof e!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",f))}}b.Signal=function(){this._bindings=[];this._prevParams=null};b.Signal.prototype={memorize:false,_shouldPropagate:true,active:true,_registerListener:function(i,h,g,f){var e=this._indexOfListener(i),j;if(e!==-1){j=this._bindings[e];if(j.isOnce()!==h){throw new Error("You cannot add"+(h?"":"Once")+"() then add"+(!h?"":"Once")+"() the same listener without removing the relationship first.")}}else{j=new c(this,i,h,g,f);this._addBinding(j)}if(this.memorize&&this._prevParams){j.execute(this._prevParams)}return j},_addBinding:function(e){var f=this._bindings.length;do{--f}while(this._bindings[f]&&e._priority<=this._bindings[f]._priority);this._bindings.splice(f+1,0,e)},_indexOfListener:function(e){var f=this._bindings.length;while(f--){if(this._bindings[f]._listener===e){return f}}return -1},has:function(e){return this._indexOfListener(e)!==-1},add:function(g,f,e){a(g,"add");return this._registerListener(g,false,f,e)},addOnce:function(g,f,e){a(g,"addOnce");return this._registerListener(g,true,f,e)},remove:function(f){a(f,"remove");var e=this._indexOfListener(f);if(e!==-1){this._bindings[e]._destroy();this._bindings.splice(e,1)}return f},removeAll:function(){var e=this._bindings.length;while(e--){this._bindings[e]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(f){if(!this.active){return}var e=Array.prototype.slice.call(arguments),h=this._bindings.slice(),g=h.length;if(this.memorize){this._prevParams=e}this._shouldPropagate=true;do{g--}while(h[g]&&this._shouldPropagate&&h[g].execute(e)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};(function(){var f=b.Signal.prototype,h=new b.Signal();function g(i,j){return Array.prototype.slice.call(i,j||0)}function e(k){b.Signal.call(this);var i=g(arguments),l=i.length,j;while(l--){j=i[l].add(this._registerDispatch,this);j.params=[l]}this._signals=i;this._params=[];this._resolved=false}e.prototype=h;e.prototype.constructor=e;h.override=false;h.unique=true;h.memorize=true;h._registerDispatch=function(i,j){if(!this._params[i]||this.override){this._params[i]=g(arguments,1)}if(this._registeredAll()&&(!this._resolved||!this.unique)){this.dispatch.apply(this,this._params)}};h._registeredAll=function(){if(this._params.length!==this._signals.length){return false}else{for(var j=0,k=this._params.length;j<k;j+=1){if(!this._params[j]){return false}}return true}};h.dispatch=function(i){i=(this._resolved&&this.unique)?this._params:g(arguments);this._resolved=true;f.dispatch.apply(this,i);if(this.unique){this.removeAll()}else{this.reset()}};h.reset=function(){this._params.length=0;this._resolved=false};h.isResolved=function(){return this._resolved};h.dispose=function(){f.dispose.call(this);delete this._signals;delete this._params};h.toString=function(){return"[CompoundSignal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"};b.CompoundSignal=e}());if(typeof define==="function"&&define.amd){define("signals",[],b)}else{if(typeof module!=="undefined"&&module.exports){module.exports=b}else{d.signals=b}}}(this));